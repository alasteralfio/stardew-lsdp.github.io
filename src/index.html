<!DOCTYPE html>
<html>
    <head>
        <title>Stardew Valley Planner</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
        <link rel="stylesheet" href="./styles.css" />
    </head>
    <body>
        <div class="app-container">
            <div class="game-viewport">
                <canvas id="layer-0" class="game-layer"></canvas>
                <canvas id="layer-1" class="game-layer"></canvas>
                <canvas id="layer-2" class="game-layer"></canvas>
                <canvas id="layer-3" class="game-layer"></canvas>
                <canvas id="layer-4" class="game-layer"></canvas>
                <canvas id="layer-5" class="game-layer"></canvas>
            </div>
            
            <div class="ui-overlay">
                <!-- ALL UI elements go here -->
                
                <div id="palette-container">
                    <!-- Category Toolbar -->
                    <div id="category-toolbar">
                        <button class="category-btn" data-category="buildings" title="Buildings">
                            <div>B</div>
                        </button>
                        <button class="category-btn" data-category="crops" title="Crops">
                            <div>C</div>
                        </button>
                        <button class="category-btn" data-category="decor" title="Decor">
                            <div>D</div>
                        </button>
                        <button class="category-btn" data-category="machines" title="Machines">
                            <div>M</div>
                        </button>
                        <button class="category-btn" data-category="wallpaper" title="Wallpaper">
                            <div>W</div>
                        </button>
                        <button class="category-btn" data-category="settings" title="Settings">
                            <div>S</div>
                        </button>
                    </div>

                    <!-- Expanding Palette Panel (hidden by default) -->
                    <div id="palette-panel">
                        <div id="search-container">
                            <input type="text" id="search-input" placeholder="Search objects..." />
                            <button id="close-palette-btn">âœ•</button>
                        </div>
                        <div id="objects-grid"></div>
                        <div id="settings-panel">
                            <button>Save Layout</button>
                            <button>Load Layout</button>
                            <button>New Layout</button>
                            <button>Debug State</button>
                        </div>
                    </div>
                </div>
                
                <div id="status-bar">
                    <span id="cursor-coords">X: 0, Y: 0</span>
                    <span id="selected-object">Selected: None</span>
                </div>
            </div>
        </div>

        <!-- Hidden file input for loading layouts -->
        <input type="file" id="loadFileInput" accept=".json" class="hidden-input" />

        <!-- Load in dependency order -->
        <script type="module">
            import { appState } from "./core/appState.js";
            import { init } from "./core/renderEngine.js";

            // Make appState globally available
            window.appState = appState;

            // Initialize when page loads
            document.addEventListener("DOMContentLoaded", async () => {
                await init();
            });

            // Clean up resources when page is unloaded
            window.addEventListener("beforeunload", () => {
                if (window.paletteController) {
                    window.paletteController.cleanup();
                }
            });
        </script>
    </body>
</html>
